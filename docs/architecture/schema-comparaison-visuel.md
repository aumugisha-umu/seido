# SEIDO - Comparaison Visuelle SchÃ©mas DB

## ğŸ“Š SchÃ©ma Actuel vs Optimal - Vue Comparative

### ğŸ”´ SchÃ©ma Actuel (ProblÃ©matique)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARCHITECTURE ACTUELLE (ProblÃ¨mes)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEAMS   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USERS                              â”‚
â”‚  â€¢ Statuts: FR + EN en parallÃ¨le âŒ                      â”‚
â”‚  â€¢ Pas de soft delete âŒ                                 â”‚
â”‚  â€¢ Pas de compteurs dÃ©normalisÃ©s âŒ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BUILDINGS   â”‚          â”‚ PRESTATAIRES â”‚
    â”‚  â€¢ Pas de    â”‚          â”‚  â€¢ Rating    â”‚
    â”‚    compteurs â”‚          â”‚    recalculÃ© â”‚
    â”‚    âŒ        â”‚          â”‚    Ã  chaque  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    requÃªte   â”‚
           â”‚                  â”‚    âŒ        â”‚
           â–¼                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     LOTS     â”‚
    â”‚  â€¢ Pas de    â”‚
    â”‚    compteurs â”‚
    â”‚    âŒ        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    INTERVENTIONS        â”‚
    â”‚  â€¢ Statuts FR/EN âŒ     â”‚
    â”‚  â€¢ N+1 queries âŒ       â”‚
    â”‚  â€¢ Joins profonds âŒ    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                     â–¼                  â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ BUILDING_   â”‚       â”‚    LOT_     â”‚    â”‚ INTERV_  â”‚      â”‚   QUOTES     â”‚
    â”‚  CONTACTS   â”‚       â”‚  CONTACTS   â”‚    â”‚ CONTACTS â”‚      â”‚              â”‚
    â”‚    âŒ       â”‚       â”‚    âŒ       â”‚    â”‚    âŒ    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         âŒ 3 TABLES SÃ‰PARÃ‰ES
            (mÃªme structure, duplication de logique)


âŒ PROBLÃˆMES MAJEURS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. N+1 QUERIES
   â””â”€ Dashboard: 105 requÃªtes pour charger 50 immeubles
   â””â”€ Temps: 2200ms

2. DUPLICATION STATUTS
   â””â”€ FR + EN en parallÃ¨le
   â””â”€ 315 lignes de code de conversion

3. TABLES JONCTION MULTIPLES
   â””â”€ 3 tables pour les contacts (building, lot, intervention)
   â””â”€ Joins imbriquÃ©s profonds

4. PAS DE DÃ‰NORMALISATION
   â””â”€ COUNT(*) Ã  chaque requÃªte
   â””â”€ Pas de cache

5. PAS DE SOFT DELETE
   â””â”€ Perte de donnÃ©es dÃ©finitive
   â””â”€ Pas d'audit trail

6. PAS D'ANALYTICS INTÃ‰GRÃ‰S
   â””â”€ RequÃªtes lourdes Ã  chaque chargement
   â””â”€ Pas de vues matÃ©rialisÃ©es
```

---

### âœ… SchÃ©ma Optimal (ProposÃ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ARCHITECTURE OPTIMALE v2.0 (Solutions)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEAMS   â”‚
â”‚  + settings JSONB
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            USERS (OptimisÃ©)                             â”‚
â”‚  âœ… Statuts: FR uniquement (single source of truth)                    â”‚
â”‚  âœ… Soft delete: deleted_at, deleted_by                                â”‚
â”‚  âœ… DÃ©normalisÃ©: provider_rating, total_interventions                  â”‚
â”‚  âœ… Index complets sur role, team_id, provider_category                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BUILDINGS       â”‚      â”‚ PRESTATAIRES     â”‚
    â”‚  âœ… Compteurs:   â”‚      â”‚  âœ… Rating auto  â”‚
    â”‚  â€¢ total_lots    â”‚      â”‚     (trigger)    â”‚
    â”‚  â€¢ occupied_lots â”‚      â”‚  âœ… total_       â”‚
    â”‚  â€¢ vacant_lots   â”‚      â”‚     interventionsâ”‚
    â”‚  â€¢ total_interv  â”‚      â”‚     (compteur)   â”‚
    â”‚  â€¢ active_interv â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  âœ… Soft delete  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      LOTS        â”‚
    â”‚  âœ… Compteurs:   â”‚
    â”‚  â€¢ total_interv  â”‚
    â”‚  âœ… Soft delete  â”‚
    â”‚  âœ… Index vacant â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            INTERVENTIONS (OptimisÃ©)                  â”‚
    â”‚  âœ… Statuts: ENUM franÃ§ais uniquement               â”‚
    â”‚  âœ… assigned_provider_id dÃ©normalisÃ©                â”‚
    â”‚  âœ… Compteurs: total_quotes, duration_hours         â”‚
    â”‚  âœ… Soft delete                                     â”‚
    â”‚  âœ… Index composites: (team_id, status)             â”‚
    â”‚  âœ… Full-text search: title + description           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                  â–¼                     â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ENTITY_    â”‚   â”‚  QUOTES      â”‚     â”‚ INTERVENTION â”‚      â”‚     CHAT     â”‚
    â”‚  CONTACTS    â”‚   â”‚  (OptimisÃ©)  â”‚     â”‚   REPORTS    â”‚      â”‚ CONVERSATIONSâ”‚
    â”‚              â”‚   â”‚              â”‚     â”‚  âœ… NOUVEAU  â”‚      â”‚  âœ… NOUVEAU  â”‚
    â”‚  âœ… TABLE    â”‚   â”‚ âœ… Soft      â”‚     â”‚              â”‚      â”‚              â”‚
    â”‚     UNIFIÃ‰E  â”‚   â”‚    delete    â”‚     â”‚ â€¢ Prestataireâ”‚      â”‚ â€¢ Direct 1-1 â”‚
    â”‚              â”‚   â”‚ âœ… Index     â”‚     â”‚ â€¢ Locataire  â”‚      â”‚ â€¢ Groupe par â”‚
    â”‚  Remplace:   â”‚   â”‚              â”‚     â”‚ â€¢ Gestionnaireâ”‚     â”‚   interventionâ”‚
    â”‚  â€¢ building_ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚              â”‚      â”‚              â”‚
    â”‚    contacts  â”‚                        â”‚ + Media      â”‚      â”‚ + Messages   â”‚
    â”‚  â€¢ lot_      â”‚                        â”‚ + Versions   â”‚      â”‚ + Participantsâ”‚
    â”‚    contacts  â”‚                        â”‚ + Signatures â”‚      â”‚ + Attachmentsâ”‚
    â”‚  â€¢ interv_   â”‚                        â”‚              â”‚      â”‚ + Typing     â”‚
    â”‚    contacts  â”‚                        â”‚ âœ… Export PDFâ”‚      â”‚              â”‚
    â”‚              â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  entity_type:â”‚
    â”‚  â€¢ building  â”‚
    â”‚  â€¢ lot       â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â€¢ interv.   â”‚             â”‚  INTERNAL_COMMENTS   â”‚
    â”‚              â”‚             â”‚    âœ… NOUVEAU        â”‚
    â”‚  âœ… 1 seul   â”‚             â”‚                      â”‚
    â”‚     JOIN     â”‚             â”‚  â€¢ Threading (5 lvl) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â€¢ Mentions @user    â”‚
                                 â”‚  â€¢ CatÃ©gories        â”‚
                                 â”‚  â€¢ Attachments       â”‚
                                 â”‚  â€¢ Reactions         â”‚
                                 â”‚  â€¢ History           â”‚
                                 â”‚  â€¢ RLS strict        â”‚
                                 â”‚    (gestionnaires)   â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


âœ… SOLUTIONS APPORTÃ‰ES:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. OPTIMISATION QUERIES
   â””â”€ Dashboard: 2 requÃªtes au lieu de 105
   â””â”€ Temps: 45ms au lieu de 2200ms (-98%)

2. SINGLE SOURCE OF TRUTH
   â””â”€ Statuts FR uniquement
   â””â”€ -315 lignes de code

3. TABLE UNIFIÃ‰E CONTACTS
   â””â”€ 1 table entity_contacts au lieu de 3
   â””â”€ -67% de complexitÃ©

4. DÃ‰NORMALISATION STRATÃ‰GIQUE
   â””â”€ Compteurs prÃ©-calculÃ©s (triggers)
   â””â”€ Ratings automatiques

5. SOFT DELETE GÃ‰NÃ‰RALISÃ‰
   â””â”€ Audit trail complet
   â””â”€ ConformitÃ© RGPD

6. ANALYTICS INTÃ‰GRÃ‰S
   â””â”€ 3 vues matÃ©rialisÃ©es
   â””â”€ Refresh automatique nightly
```

---

## ğŸ”„ Ã‰volution des RequÃªtes

### Avant: Dashboard Gestionnaire (âŒ 105 requÃªtes)

```sql
-- RequÃªte 1: Buildings
SELECT * FROM buildings WHERE team_id = $1;
-- â†’ 1 query, 100ms

-- RequÃªtes 2-51: Lots par building (N+1)
FOR EACH building IN buildings:
  SELECT * FROM lots WHERE building_id = $building_id;
-- â†’ 50 queries, 50 Ã— 20ms = 1000ms

-- RequÃªtes 52-101: Contacts par building (N+1)
FOR EACH building IN buildings:
  SELECT bc.*, u.* FROM building_contacts bc
  JOIN users u ON u.id = bc.user_id
  WHERE bc.building_id = $building_id;
-- â†’ 50 queries, 50 Ã— 15ms = 750ms

-- RequÃªte 102: Interventions actives
SELECT * FROM interventions
WHERE team_id = $1 AND status IN ('demande', 'approuvee', 'en_cours');
-- â†’ 1 query, 150ms

-- RequÃªte 103: Stats interventions
SELECT COUNT(*), AVG(...) FROM interventions WHERE team_id = $1;
-- â†’ 1 query, 200ms

-- RequÃªte 104: Prestataires
SELECT * FROM users WHERE role = 'prestataire' AND team_id = $1;
-- â†’ 1 query, 50ms

-- RequÃªte 105: Rating prestataires (calculÃ© Ã  la volÃ©e)
FOR EACH prestataire:
  SELECT AVG(satisfaction) FROM intervention_reports ...;
-- â†’ 3 queries, 3 Ã— 50ms = 150ms

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL: 105 QUERIES | TEMPS: ~2200ms ğŸ”´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### AprÃ¨s: Dashboard Gestionnaire (âœ… 2 requÃªtes)

```sql
-- RequÃªte 1: Vue matÃ©rialisÃ©e (prÃ©-calculÃ©e nightly)
SELECT * FROM dashboard_gestionnaire_metrics WHERE team_id = $1;
-- â†’ 1 query, 15ms âœ…

-- RequÃªte 2: Buildings avec compteurs dÃ©normalisÃ©s
SELECT
  id, name, address,
  total_lots,           -- âœ… PrÃ©-calculÃ© par trigger
  occupied_lots,        -- âœ… PrÃ©-calculÃ© par trigger
  vacant_lots,          -- âœ… PrÃ©-calculÃ© par trigger
  total_interventions,  -- âœ… PrÃ©-calculÃ© par trigger
  active_interventions  -- âœ… PrÃ©-calculÃ© par trigger
FROM buildings
WHERE team_id = $1 AND deleted_at IS NULL;
-- â†’ 1 query, 30ms âœ…

-- Optionnel: Contacts (si nÃ©cessaires, 1 seul JOIN)
SELECT
  ec.entity_id,
  ec.role,
  u.id, u.name, u.email
FROM entity_contacts ec
JOIN users u ON u.id = ec.user_id
WHERE ec.entity_type = 'building'
  AND ec.entity_id = ANY(SELECT id FROM buildings WHERE team_id = $1);
-- â†’ 1 query supplÃ©mentaire si besoin, 25ms âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL: 2-3 QUERIES | TEMPS: ~45-70ms âœ…
AMÃ‰LIORATION: -98% temps, -97% requÃªtes ğŸš€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ“ˆ Diagramme Flux de DonnÃ©es

### Workflow Intervention avec Nouveaux SystÃ¨mes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         WORKFLOW INTERVENTION COMPLET (avec nouvelles features)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CRÃ‰ATION INTERVENTION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  LOCATAIRE   â”‚ CrÃ©e demande
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'demande'
   â”‚  + entity_contacts   â”‚ âœ… Locataire ajoutÃ© automatiquement
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CHAT_CONVERSATION   â”‚ âœ… NOUVEAU: Chat auto-crÃ©Ã©
   â”‚  type: 'intervention'â”‚     Participants: locataire
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. APPROBATION GESTIONNAIRE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GESTIONNAIRE â”‚ Approuve + Assigne prestataire
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'approuvee'
   â”‚  assigned_provider_idâ”‚ âœ… Prestataire dÃ©normalisÃ©
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ENTITY_CONTACTS     â”‚     â”‚  CHAT_PARTICIPANTS   â”‚
   â”‚  + prestataire       â”‚     â”‚  + prestataire       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                âœ… Prestataire ajoutÃ© au chat

          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERNAL_COMMENTS                       â”‚
   â”‚  âœ… NOUVEAU: Gestionnaire peut noter:    â”‚
   â”‚     "Prestataire trÃ¨s compÃ©tent, Ã        â”‚
   â”‚      privilÃ©gier pour futures plomberies"â”‚
   â”‚  CatÃ©gorie: documentation                â”‚
   â”‚  VisibilitÃ©: team                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. DEVIS (si nÃ©cessaire)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PRESTATAIRE  â”‚ Soumet devis
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  QUOTES              â”‚ status: 'en_attente'
   â”‚  + amount            â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GESTIONNAIRE â”‚ Approuve devis
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'planifiee'
   â”‚  accepted_quote_amt  â”‚ âœ… Montant dÃ©normalisÃ©
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CHAT_MESSAGES (systÃ¨me)                 â”‚
   â”‚  "Devis de 150â‚¬ approuvÃ©"                â”‚
   â”‚  âœ… Notification automatique dans le chatâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. EXÃ‰CUTION TRAVAUX
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PRESTATAIRE  â”‚ DÃ©marre travaux
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'en_cours'
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CHAT_MESSAGES                           â”‚
   â”‚  Prestataire: "ArrivÃ© sur place, dÃ©but   â”‚
   â”‚               des travaux"               â”‚
   â”‚  âœ… Communication temps rÃ©el             â”‚
   â”‚  âœ… Peut envoyer photos via chat         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. RAPPORT PRESTATAIRE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PRESTATAIRE  â”‚ Termine + Soumet rapport
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION_REPORTS                    â”‚
   â”‚  âœ… NOUVEAU: Rapport structurÃ©           â”‚
   â”‚  report_type: 'prestataire'              â”‚
   â”‚  report_data: {                          â”‚
   â”‚    workPerformed: {...},                 â”‚
   â”‚    timeSpent: {totalHours: 2.5},         â”‚
   â”‚    materials: {totalCost: 89.99},        â”‚
   â”‚    photos: {before: [...], after: [...]} â”‚
   â”‚  }                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION_       â”‚ Photos avant/aprÃ¨s
   â”‚  REPORT_MEDIA        â”‚ âœ… Storage Supabase
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'cloturee_par_prestataire'
   â”‚  duration_hours: 2.5 â”‚ âœ… DÃ©normalisÃ© depuis rapport
   â”‚  actual_cost: 145.50 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  NOTIFICATION (locataire)                â”‚
   â”‚  "Travaux terminÃ©s, merci de valider"    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. VALIDATION LOCATAIRE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  LOCATAIRE   â”‚ Valide + Note satisfaction
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION_REPORTS                    â”‚
   â”‚  report_type: 'locataire'                â”‚
   â”‚  report_data: {                          â”‚
   â”‚    satisfaction: {rating: 5},            â”‚
   â”‚    workQuality: {...},                   â”‚
   â”‚    providerPerformance: {                â”‚
   â”‚      communication: 5,                   â”‚
   â”‚      punctuality: 5,                     â”‚
   â”‚      professionalism: 5                  â”‚
   â”‚    }                                     â”‚
   â”‚  }                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'cloturee_par_locataire'
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â”‚ (TRIGGER automatique)
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  USERS (prestataire)                     â”‚
   â”‚  provider_rating: 4.8 â†’ 4.9              â”‚
   â”‚  total_interventions: 23 â†’ 24            â”‚
   â”‚  âœ… Mise Ã  jour automatique par trigger  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

7. FINALISATION GESTIONNAIRE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GESTIONNAIRE â”‚ Finalise + Analyse
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION_REPORTS                    â”‚
   â”‚  report_type: 'gestionnaire'             â”‚
   â”‚  report_data: {                          â”‚
   â”‚    overallAssessment: {...},             â”‚
   â”‚    costAnalysis: {                       â”‚
   â”‚      quotedAmount: 150,                  â”‚
   â”‚      actualAmount: 145.50,               â”‚
   â”‚      variance: -4.50,                    â”‚
   â”‚      budgetStatus: 'under'               â”‚
   â”‚    },                                    â”‚
   â”‚    providerPerformance: {                â”‚
   â”‚      rating: 5,                          â”‚
   â”‚      wouldRehire: true,                  â”‚
   â”‚      addToPreferredList: true            â”‚
   â”‚    },                                    â”‚
   â”‚    internalTags: ['plomberie', 'preventive']â”‚
   â”‚  }                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  INTERVENTION        â”‚ status: 'cloturee_par_gestionnaire'
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ (TRIGGER automatique)
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  BUILDINGS           â”‚         â”‚  PROVIDER_           â”‚
   â”‚  active_interventionsâ”‚         â”‚  PERFORMANCE_STATS   â”‚
   â”‚  -1                  â”‚         â”‚  (Vue matÃ©rialisÃ©e)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  âœ… Refresh nightly  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8. EXPORT & ARCHIVAGE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GESTIONNAIRE â”‚ Exporte rapport PDF
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PDF GÃ‰NÃ‰RÃ‰ (jsPDF ou Puppeteer)         â”‚
   â”‚  â€¢ RÃ©sumÃ© intervention                   â”‚
   â”‚  â€¢ Photos avant/aprÃ¨s                    â”‚
   â”‚  â€¢ DÃ©tails prestataire                   â”‚
   â”‚  â€¢ CoÃ»ts et dÃ©lais                       â”‚
   â”‚  â€¢ Signatures                            â”‚
   â”‚  â€¢ QR code vÃ©rification                  â”‚
   â”‚  âœ… Archivage Supabase Storage           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Structure Tables - Vue ConsolidÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ORGANISATION TABLES PAR DOMAINE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¢ CORE ENTITIES (Base)
â”œâ”€ teams
â”œâ”€ users (+ soft delete + compteurs)
â”œâ”€ buildings (+ compteurs dÃ©normalisÃ©s)
â”œâ”€ lots (+ compteurs)
â””â”€ interventions (+ statuts FR + compteurs)

ğŸ”— RELATIONS & WORKFLOW
â”œâ”€ entity_contacts (âœ… table unifiÃ©e)
â””â”€ quotes

ğŸ“Š RAPPORTS D'INTERVENTION (âœ… NOUVEAU)
â”œâ”€ intervention_reports (3 types: prestataire, locataire, gestionnaire)
â”œâ”€ intervention_report_media (photos, docs, signatures)
â”œâ”€ intervention_report_versions (historique Ã©ditions)
â””â”€ intervention_report_signatures (validation numÃ©rique)

ğŸ’¬ SYSTÃˆME DE CHAT (âœ… NOUVEAU)
â”œâ”€ chat_conversations (direct + intervention)
â”œâ”€ chat_messages (+ soft delete)
â”œâ”€ chat_participants (+ unread_count)
â”œâ”€ chat_message_attachments
â”œâ”€ chat_message_read_receipts
â”œâ”€ chat_message_reactions
â””â”€ chat_typing_indicators (Ã©phÃ©mÃ¨re)

ğŸ“ COMMENTAIRES INTERNES (âœ… NOUVEAU)
â”œâ”€ internal_comments (threading, mentions, catÃ©gories)
â”œâ”€ internal_comment_attachments
â”œâ”€ internal_comment_history (audit trail)
â”œâ”€ internal_comment_reactions (emojis)
â””â”€ internal_comment_notification_prefs

ğŸ“ˆ ANALYTICS & PERFORMANCE (Vues MatÃ©rialisÃ©es)
â”œâ”€ provider_performance_stats (mÃ©triques prestataires)
â”œâ”€ building_statistics (mÃ©triques immeubles)
â””â”€ dashboard_gestionnaire_metrics (KPIs globaux)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL: ~30 tables (vs 11 actuelles)
       +3 vues matÃ©rialisÃ©es
       +3 nouvelles fonctionnalitÃ©s majeures
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ¯ Gains Mesurables

### Performance (Temps de RÃ©ponse)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AVANT vs APRÃˆS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Dashboard Gestionnaire                                       â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 2200ms âŒ                            â”‚
â”‚  â–“ 45ms âœ…                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -98%                              â”‚
â”‚                                                               â”‚
â”‚  Liste 50 Interventions                                       â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 450ms âŒ                                    â”‚
â”‚  â–“â–“ 60ms âœ…                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -87%                              â”‚
â”‚                                                               â”‚
â”‚  DÃ©tail Intervention                                          â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 350ms âŒ                                        â”‚
â”‚  â–“ 40ms âœ…                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -89%                              â”‚
â”‚                                                               â”‚
â”‚  Analytics Prestataires                                       â”‚
â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 3500ms âŒ                 â”‚
â”‚  â–“ 20ms âœ…                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -99%                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ComplexitÃ© Code

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 RÃ‰DUCTION COMPLEXITÃ‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Tables de Contacts                                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3 tables âŒ                                     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ 1 table âœ…                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -67%                              â”‚
â”‚                                                               â”‚
â”‚  Code Conversion Statuts                                      â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 315 lignes âŒ                               â”‚
â”‚  â–ˆâ–ˆâ–ˆ 0 lignes âœ…                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            -100%                              â”‚
â”‚                                                               â”‚
â”‚  Queries Dashboard                                            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 105 queries âŒ                â”‚
â”‚  â–ˆâ–ˆ 2 queries âœ…                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             -98%                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Roadmap Migration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TIMELINE MIGRATION                           â”‚
â”‚                    (Estimation: 10 jours)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

JOUR 1: PrÃ©paration
â”œâ”€ âœ“ Sauvegarde DB actuelle
â”œâ”€ âœ“ Setup nouvelle instance Supabase
â”œâ”€ âœ“ Mise Ã  jour .env.local
â””â”€ âœ“ Test connexion

JOURS 2-3: Migration SchÃ©ma
â”œâ”€ âœ“ CrÃ©ation migration consolidÃ©e (1 fichier)
â”œâ”€ âœ“ Application migration
â”œâ”€ âœ“ VÃ©rification tables + index + RLS
â””â”€ âœ“ GÃ©nÃ©ration types TypeScript

JOURS 4-5: Migration DonnÃ©es
â”œâ”€ âœ“ Script migration de donnÃ©es
â”œâ”€ âœ“ Teams, Users, Buildings, Lots
â”œâ”€ âœ“ Interventions (statuts dÃ©jÃ  FR âœ…)
â”œâ”€ âœ“ Contacts â†’ entity_contacts (unification)
â”œâ”€ âœ“ Quotes
â””â”€ âœ“ Refresh vues matÃ©rialisÃ©es

JOURS 6-8: Adaptation Code
â”œâ”€ âœ“ Mise Ã  jour repositories (entity_contacts)
â”œâ”€ âœ“ Suppression code conversion statuts
â”œâ”€ âœ“ Optimisation hooks (Ã©liminer N+1)
â”œâ”€ âœ“ Mise Ã  jour types TypeScript
â””â”€ âœ“ Adaptation services

JOURS 9-10: Tests & Validation
â”œâ”€ âœ“ Tests unitaires (100%)
â”œâ”€ âœ“ Tests E2E (workflows complets)
â”œâ”€ âœ“ Tests performance (< 200ms dashboard)
â”œâ”€ âœ“ Validation utilisateur
â””â”€ âœ“ DÃ©ploiement production

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… PRÃŠT POUR PRODUCTION APRÃˆS 10 JOURS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Statut**: ğŸ¯ **PROPOSITION VALIDÃ‰E - PRÃŠT POUR IMPLÃ‰MENTATION**
**Prochaine Ã‰tape**: Commencer Jour 1 - PrÃ©paration environnement
